
[Powershell - EventDescription]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process=powershell.exe | stats values(EventDescription) by process

[Sysmon - Top EventDescription]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` | top EventDescription

[Sysmon - Parent to Child]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` NOT splunk | stats values(ParentImage) by process

[EventDescription - by process, Commandline]
action.email.useNSSubject = 1
alert.track = 0
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` NOT splunk | stats values(EventDescription) by process,CommandLine

[Powershell - All PoSh by Computer]
action.email.useNSSubject = 1
alert.track = 0
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process=powershell.exe | stats values(CommandLine) by Computer,process

[net - All net usage]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -60m@m
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process=net.exe | stats count by Computer,CommandLine

[wmic.exe - all wmic execution]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -60m@m
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process=wmic.exe | stats count by Computer,CommandLine

[CommandLine - By computer, process]
action.email.useNSSubject = 1
alert.track = 0
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon`  | stats values(CommandLine) by Computer,process

[Net - Group, localgroup]
action.email.useNSSubject = 1
alert.track = 0
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="net.exe" (CommandLine="*net  group*" OR CommandLine="*net  localgroup*") | stats count by Computer,CommandLine

[Users by Computer]
action.email.useNSSubject = 1
alert.track = 0
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` | stats values(user) by Computer

[Commandline by user]
action.email.useNSSubject = 1
alert.track = 0
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` | stats values(CommandLine) by user

[Net - net view]
action.email.useNSSubject = 1
alert.track = 0
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process=net.exe (CommandLine="net  view") | stats count by Computer,CommandLine

[Windows Credential Editor]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` ParentImage="services.exe" | regex CommandLine="\\\\[a-z0-9]{8}-[a-z0-9]{4}-[az0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}\.exe-S$"

[mimikatz]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` CommandLine="*privileges::debug*" OR CommandLine="*sekurlsa::*" OR CommandLine="*kerberos::*" OR CommandLine="*crypto::*" OR CommandLine="*lsadump::*" OR CommandLine="*process::*"

[gsecdump]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="g64-*" | regex process="\\\\g64-[a-z0-9]{3}\.exe$"

[wmic - process call create]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="WMIC.exe" CommandLine="*process call create*"

[wmiprvse - parent execution]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` ParentImage="WmiPrvSE.exe" | stats count by Computer,CommandLine

[wmic - /node]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="WMIC.exe" CommandLine="*/NODE:*"

[vssadmin - delete]
action.email.useNSSubject = 1
alert.track = 0
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 process=vssadmin.exe | search CommandLine="*vssadmin*" CommandLine="*Delete *" CommandLine="*Shadows*"

[taskeng - parentproc all]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` ParentImage="taskeng.exe" | stats count by Computer,CommandLine

[schtasks - run]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="schtasks.exe" CommandLine="*/Run*" CommandLine="*/s *"

[schtasks - delete]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="schtasks.exe" CommandLine="*/Delete*" CommandLine="*/s *"

[schtasks - create]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="schtasks.exe" CommandLine="*/Create*" CommandLine="*/s *"

[schtasks - change]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="schtasks.exe" CommandLine="*/Change*" CommandLine="*/s *"

[schtasks - all]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="schtasks.exe"|  stats count by Computer,CommandLine

[rundll32 - suspicious execution]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 rundll32.exe \
| search Image="rundll32.exe" (CommandLine="AppData\\Local\\Temp*" CommandLine="*qwerty*") \
OR (ParentImage="winword.exe" \
OR ParentImage="excel.exe" OR ParentImage="cscript.exe" \
OR ParentImage="wscript.exe" OR ParentImage="mshta.exe")

[psexecsvc - all]
action.email.useNSSubject = 1
alert.track = 0
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` ParentImage="PSEXESVC.EXE" | stats count by Image,Hashes

[psexec - IMPHASH not psexec.exe]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` Hashes="*IMPHASH=B18A1401FF8F444056D29450FBC0A6CE*" NOT process="*PsExec.exe"

[psexec - IMPHASH]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
  display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` Hashes="*IMPHASH=B18A1401FF8F444056D29450FBC0A6CE*"

[powershell - invoke-command]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="*powershell.exe" CommandLine="*Invoke-Command*"

[at execution]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` ParentImage="at.exe" | stats count by Computer,CommandLine

[wsmprovhost - powershell]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` ParentImage="*wsmprovhost.exe" | stats count by Computer,CommandLine

[msbuild - all]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="msbuild.exe"| stats count by Computer,CommandLine

[rundll32.exe - all]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="rundll32.exe"| stats count by Computer,CommandLine

[rundll32.exe - Control_RunDLL]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="rundll32.exe" CommandLine="*,Control_RunDLL"| stats count by Computer,CommandLine

[rundll32.exe - DllRegisterServer]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="rundll32.exe" DllRegisterServer | stats count by Computer,CommandLine

[rundll32.exe - \\roaming\\ execution]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="rundll32.exe" \\roaming\\ | stats count by Computer,CommandLine

[cscript - http]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="cscript.exe" http | stats count by Computer,CommandLine

[wscript - js execution]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="wscript.exe" .js | stats count by Computer,CommandLine

[wscript - vbs or vbe execution]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="wscript.exe" CommandLine=*.vbs* OR CommandLine=*.vbe* | stats count by Computer,CommandLine

[wscript - Suspicious rar/zip userprofile execution]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="wscript.exe" \\Rar$  OR ".zip" \\appdata\\ | stats count by Computer,CommandLine

[netsh - all]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="netsh.exe" | stats values(CommandLine) by Computer

[bitsadmin - all]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="bitsadmin.exe" | stats values(CommandLine) by Computer

[Net - IPC$ access]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="net.exe" *ipc$* | stats values(CommandLine) by Computer

[installutil - all]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="installutil.exe" | stats values(CommandLine) by Computer

[Powershell - EncodedCommand]
action.email.useNSSubject = 1
alert.track = 0
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="powershell.exe" (CommandLine="*-encodedcommand*" OR CommandLine="*-enc*" OR CommandLine="-e" OR CommandLine="-ec" OR CommandLine="-encodedcomman" OR CommandLine="-encodedcomma" OR CommandLine="-encodedcomm" OR CommandLine="-encodedcom" OR CommandLine="-encodedco" OR CommandLine="-encodedc" OR CommandLine="-encoded" OR CommandLine="-encode" OR CommandLine="-encod" OR CommandLine="-enco" OR CommandLine="-en")| stats count by CommandLine | top CommandLine

[Critical Process]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.events.fields = ["host","source","sourcetype","action","app","CommandLine","Computer","CreationUtcTime","CurrentDirectory","dest","direction","dvc","EventChannel","EventCode","EventDescription","eventtype","Hashes","process","index","IntegrityLevel","Keywords","Level","linecount","LogonGuid","LogonId","Opcode","ParentCommandLine","ParentImage","ParentProcessGuid","ParentProcessId","PreviousCreationUtcTime","process","process_id","ProcessGuid","ProcessId","punct","RecordID","SecurityID","session_id","signature","signature_id","splunk_server","tag","tag::eventtype","TargetFilename","Task","TerminalSessionId","TimeCreated","timestamp","User","user","UtcTime","vendor_product","Version"]
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
display.visualizations.type = singlevalue
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process="powershell.exe" OR process="msbuild.exe" OR process="psexec.exe" OR process="at.exe" OR process="schtasks.exe" OR process="net.exe" OR process="vssadmin.exe" OR process="utilman.exe" OR process="wmic.exe" OR process="mshta.exe" OR process="wscript.exe" OR process="cscript.exe" OR process="cmd.exe" OR process="whoami.exe" OR process="mmc.exe" OR process="systeminfo.exe" OR process="csvde.exe" OR process="certutil.exe" | stats count by process


[IOC - svchost.exe not run by services.exe]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */15 * * * *
dispatch.earliest_time = -15m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
display.visualizations.type = mapping
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode="1" svchost.exe\
| search (Image="svchost.exe") (ParentImage!="services.exe")

[IOC - >5 Critical Process in 10m]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */10 * * * *
dispatch.earliest_time = -10m
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = pie
display.visualizations.type = mapping
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode="1" (process="powershell.exe" OR process="msbuild.exe" OR process="psexec.exe" OR process="at.exe" OR process="schtasks.exe" OR process="net.exe" OR process="vssadmin.exe" OR process="utilman.exe" OR process="wmic.exe" OR process="mshta.exe" OR process="whoami.exe" OR process="mmc.exe" OR process="systeminfo.exe" OR process="csvde.exe" OR process="nbtstat.exe")  ParentImage!="C:\\Program Files (x86)\\Microsoft Visual Studio Common7\\IDE\\devenv.exe"  ParentImage="C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\Common7\\ServiceHub\\Hosts\\ServiceHub.Host.Node.x86\\ServiceHub.Host.Node.x86.exe" | bin span=10m _time   | stats  values(CommandLine), count by host _time

[IOC - Suspicious Driver Loaded from Temp]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
description = Driver loaded from /temp/ directory
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=6 ImageLoaded="*\Temp\*"

[IOC - Suspicious Exe Path]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode="1" (Image="$Recycle.bin" OR process="Users\\All Users\\*" OR process="Users\\Default\\*" OR process="C:\\Perflogs\\*" OR process="config\\systemprofile\\*" OR process="Windows\\Fonts\\*" OR process="Windows\\IME\\*" OR process="Windows\\addins\\*")

[IOC - Eventviewer UAC Bypass]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
description = Detects UAC bypass method using Windows event viewer
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=13 TargetObject="HKey_Users\\mscfile*"

[IOC - UAC Bypass sdclt]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
description = Detects changes to HKCU:\Software\Classes\exefile\shell\runas\command\isolatedCommand
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=13 TargetObject="HKEY_USERS\\Classes\\exefile\\shell\\runas\\command\\isolatedCommand"

[IOC - Powershell Suspicious Strings]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = pie
display.visualizations.type = mapping
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 powershell.exe Invoke* OR IEX OR Download* \
| table _time, host, ProcessID, process, CommandLine, ParentProcessId, ParentImage, ParentCommandLine

[IOC - Abnormally long Powershell Command]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
display.visualizations.type = mapping
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 process=powershell.exe | eval c_length=len(CommandLine) | where c_length>500

[IOC - Commands run from Office Doc/Browser]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */15 * * * *
dispatch.earliest_time = -15m
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = pie
display.visualizations.type = mapping
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 ParentImage="C:\\Program Files (x86)\\Microsoft Office\\Office14\\WINWORD.EXE" OR ParentImage="C:\\Program Files (x86)\\Microsoft Office\\Office14\\OUTLOOK.EXE" OR ParentImage="C:\\Program Files (x86)\\Microsoft Office\\Office14\\EXCEL.EXE" OR ParentImage="C:\\Program Files (x86)\\Microsoft Office\\Office14\\POWERPNT.EXE" OR ParentImage="C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe" OR ParentImage="C:\\Program Files\\Internet Explorer\\iexplore.exe" OR ParentImage="C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe" OR ParentImage="C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe" AND (Image="C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe" OR Image="C:\\Windows\\System32\\cmd.exe" OR Image="C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe" OR Image="C:\\Windows\\System32\\rundll32.exe" OR Image="C:\\Windows\\System32\\wscript.exe" OR Image="C:\\Windows\\System32\\cscript.exe") CurrentDirectory!="C:\\Program Files (x86)\\Adobe\\Acrobat Reader DC\\Reader\\Browser\\WCChromeExtn\\"  CurrentDirectory!="C:\\Users\\AppData\\Local\\Blue Jeans\\App\\" CommandLine!="*ScreenConnect*" CommandLine!="C:\\windows\\system32\\rundll32.exe C:\\windows\\system32\\inetcpl.cpl,ClearMyTracksByProcess*"| table  _time host ParentImage CommandLine

[IOC - Suspicious binary launch location]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */15 * * * *
dispatch.earliest_time = -15m
display.page.search.mode = fast
display.visualizations.charting.chart = pie
display.visualizations.type = mapping
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode="1" (Image="C:\\windows\\fonts\\*" OR Image="C:\\windows\\help\\*" OR Image="C:\\windows\\wbem\\*" OR Image="C:\\windows\\addins\\*" OR Image="C:\\windows\\debut\\*" OR Image="C:\\windows\\system32\\tasks*" OR Image="C:\\windows\\tasks\\*" OR Image="C:\\debug\\*")

[IOC - Suspicious execution of rundll - User Profile/Browser]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
display.visualizations.type = mapping
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` `sysmon`  EventCode=1 Image="C:\\Windows\\system32\\rundll32.exe" CommandLine=*C:\\Users\\* ParentCommandLine=\"C:\\Program Files\\Internet Explorer\\Iexplore.exe\"

[IOC - Certutil Decode in Appdata]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
description = Detetcs a Microsoft certutil execution with the 'decode' sub command on files in the AppData folder, which is sometimes used to decode malicious code with the built-in certutil utility
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 process="certutil.exe" CommandLine="* -decode AppData\\*"

[IOC - Download from bitsadmin]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
description = Detects usage of bitsadmin downloading a file
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 process="bitsadmin.exe" CommandLine="/transfer"

[IOC - MSHTA Spawning Windows Shell]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
description = Detects a Windows command line executable started from MSHTA
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 ParentImage=*\\mshta.exe (process="cmd.exe" OR process="powershell.exe" OR process="wscript.exe" OR process="cscript.exe" OR process="sh.exe" OR process="bash.exe")

[IOC - Process Created by MMC]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
description = Processes started by MMC could by a sign of lateral movement using MMC application COM object
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1  ParentImage=*\\mmc.exe process="cmd.exe" CommandLine!="runcmd.cmd"

[IOC - Shellcode Injected from Office]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=10 TargetImage="verclsid.exe" GrantedAccess="0x1FFFFF" (CallTrace="*|UNKNOWN(*VBE7.DLL*" OR (SourceImage="Microsoft Office\\*" AND CallTrace="*|UNKNOWN*"))

[IOC - Suspicious Powershell Exe from Scripting]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 (ParentImage="wscript.exe" OR ParentImage="cscript.exe") process="powershell.exe"

[IOC - Suspicious Script Execution]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
description = Detects suspicious file execution by wscript and cscript
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1  (process="wscript.exe" OR process="cscript.exe") (CommandLine="*.jse" OR CommandLine="*.vbe" OR CommandLine="*.js" OR CommandLine="*.vba" OR CommandLine="*.vbe")

[IOC - Vssadmin Activity]
action.email.useNSSubject = 1
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
description = Detects suspicious commands that could be related to activity that uses volume shadow copy to steal and retrieve hashes from the NTDS.dit file remotely
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = pie
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1  (CommandLine="vssadmin.exe Delete Shadows" OR CommandLine="vssadmin create shadow /for=C:" OR CommandLine="copy \\\\?\\GLOBALROOT\\Device\\windows\\ntds\\ntds.dit" OR CommandLine="copy \\?\GLOBALROOT\Device\*\config\SAM" OR CommandLine="vssadmin delete shadows /for=C:" OR CommandLine="reg SAVE HKLM\SYSTEM ")

[IOC - MSHTA JavaScript Invoke]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 process=mshta.exe CommandLine=*javascript:* | table Computer ParentImage ParentCommandLine process CommandLine user LogonGuid

[IOC - Powershell Suspicious Strings 01]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = pie
display.visualizations.type = mapping
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 process=powershell.exe (*-W*Hidden* OR *-nologo* OR *-nop* OR *IEX* OR *Out-MiniDump* OR *-enc* OR *-EncodedCommand* OR *DownloadString* OR *DownloadFile* OR *DownloadData* OR *ShellExecute* OR *Invoke-Mimikatz* OR *schtasks*create* OR *Webclient* OR *FromBase64String* OR *IO.StreamReader* OR *IO.MemoryStream* OR *IO.Compression.DeflateStream* ) NOT ( C:\\windows\\ccm\\)\
| table _time, host, process, CommandLine, ParentProcessId, ParentImage, ParentCommandLine, User

[T1086 - Powershell Suspicious Strings]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.suppress = 0
alert.track = 0
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.general.type = statistics
display.page.search.mode = verbose
display.page.search.tab = statistics
display.visualizations.charting.chart = pie
display.visualizations.show = 0
display.visualizations.type = mapping
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 process=powershell.exe (*-W*Hidden* OR *-nologo* OR *-nop* OR *IEX* OR *Out-MiniDump* OR *-enc* OR *-EncodedCommand* OR *DownloadString* OR *DownloadFile* OR *DownloadData* OR *ShellExecute* OR *Invoke-Mimikatz* OR *schtasks*create* OR *Webclient* OR *FromBase64String* OR *IO.StreamReader* OR *IO.MemoryStream* OR *IO.Compression.DeflateStream* ) NOT ( C:\\windows\\ccm\\)\
| table _time, host, process, CommandLine, ParentProcessId, ParentImage, ParentCommandLine, User

[T1015_Accessibility_Backdoor]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.track = 0
description = T1015_Accessibility_Backdoor
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
dispatchAs = user
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.charting.chart = bar
display.visualizations.show = 0
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 (\
(ParentImage=*\\winlogon.exe \
((process=Utilman.exe CommandLine=*/debug*) OR (process=sethc.exe (CommandLine=*sethc.exe 211* OR CommandLine=*sethc.exe 101*)))) \
OR\
(ParentImage=*\\utilman.exe (CommandLine=*osk.exe* OR CommandLine=*magnify.exe* OR CommandLine=*narrator.exe* OR CommandLine=*DisplaySwitch.exe* OR CommandLine=*AtBroker.exe*))\
)\
| table _time, host, process, CommandLine, ParentProcessId, ParentImage, ParentCommandLine, User

[IOC - Disable Startup Repair]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.visualizations.charting.chart = bubble
display.visualizations.custom.type = Splunk_ML_Toolkit.ScatterLineViz
display.visualizations.type = custom
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process=BCDEDIT.EXE (CommandLine=*/set*recoveryenable*no* OR CommandLine=*/set*bootstatuspolicy*ignoreallfailures*)

[Runs From RECYCLEBIN]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.track = 0
dispatch.earliest_time = -7d@h
dispatch.latest_time = now
dispatchAs = user
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.charting.chart = bubble
display.visualizations.custom.type = Splunk_ML_Toolkit.ScatterLineViz
display.visualizations.show = 0
display.visualizations.type = custom
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 $RECYCLE.BIN OR \\RECYCLER\\ | stats values(host) as host values(CommandLine) values(user) count by ParentImage process

[Runs from SYSVOL]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.charting.chart = bubble
display.visualizations.custom.type = Splunk_ML_Toolkit.ScatterLineViz
display.visualizations.show = 0
display.visualizations.type = custom
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 :\\System Volume Information\\ | stats values(host) as host values(CommandLine) values(user) count by ParentImage Image

[T1117 - REGSVR Proxy Execution]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.severity = 4
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.charting.chart = bubble
display.visualizations.custom.type = Splunk_ML_Toolkit.ScatterLineViz
display.visualizations.type = custom
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 process=REGSVR32.EXE CommandLine=*/i:*http://* | table _time host Image CommandLine ParentImage ParentCommandLine host user

[rundll32.exe - \\roaming\\ execution]
action.securityanalytics_ar.param.verbose = 0
search = `sysmon` process=rundll32.exe \\roaming\\ | stats count by Computer,CommandLine,ParentCommandLine

[rundll32.exe - All Executions]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.track = 0
description = T1085
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.charting.chart = bubble
display.visualizations.custom.type = Splunk_ML_Toolkit.ScatterLineViz
display.visualizations.show = 0
display.visualizations.type = custom
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process=rundll32.exe | stats values(ParentImage) values(process) count by CommandLine

[rundll32.exe - Control_RunDLL]
action.securityanalytics_ar.param.verbose = 0
search = `sysmon` EventCode=1 process=rundll32.exe CommandLine="*,Control_RunDLL"| stats count by Computer,CommandLine

[T1085 - rundll32 with javascript arg]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.charting.chart = bubble
display.visualizations.custom.type = Splunk_ML_Toolkit.ScatterLineViz
display.visualizations.type = custom
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` EventCode=1 process=rundll32.exe CommandLine=*javascript:* | table _time host process ParentImage CommandLine ParentCommandLine

[IOC - Suspicious msiexec execution]
action.email.useNSSubject = 1
action.securityanalytics_ar.param.verbose = 0
alert.suppress = 0
alert.track = 1
counttype = number of events
cron_schedule = */20 * * * *
dispatch.earliest_time = -20m
display.page.search.mode = verbose
display.visualizations.charting.chart = bar
display.visualizations.custom.type = Splunk_ML_Toolkit.ScatterLineViz
display.visualizations.type = singlevalue
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = sysmon-splunk-app
request.ui_dispatch_view = search
search = `sysmon` process=msiexec.exe CommandLine=*/i*http*
